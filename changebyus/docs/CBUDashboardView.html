<!DOCTYPE html>

<html>
<head>
  <title>CBUDashboardView.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="FlaggedProjectCollection.html">
                FlaggedProjectCollection.coffee
              </a>
            
              
              <a class="source" href="FlaggedUserCollection.html">
                FlaggedUserCollection.coffee
              </a>
            
              
              <a class="source" href="ProjectCalendarCollection.html">
                ProjectCalendarCollection.coffee
              </a>
            
              
              <a class="source" href="ProjectDiscussionsCollection.html">
                ProjectDiscussionsCollection.coffee
              </a>
            
              
              <a class="source" href="ProjectListCollection.html">
                ProjectListCollection.coffee
              </a>
            
              
              <a class="source" href="ProjectMembersCollection.html">
                ProjectMembersCollection.coffee
              </a>
            
              
              <a class="source" href="ResourceListCollection.html">
                ResourceListCollection.coffee
              </a>
            
              
              <a class="source" href="StreamCollection.html">
                StreamCollection.coffee
              </a>
            
              
              <a class="source" href="UnapprovedResourcesCollection.html">
                UnapprovedResourcesCollection.coffee
              </a>
            
              
              <a class="source" href="UpdatesCollection.html">
                UpdatesCollection.coffee
              </a>
            
              
              <a class="source" href="main.html">
                main.coffee
              </a>
            
              
              <a class="source" href="CityModel.html">
                CityModel.coffee
              </a>
            
              
              <a class="source" href="PostReplyModel.html">
                PostReplyModel.coffee
              </a>
            
              
              <a class="source" href="ProjectCalendarModel.html">
                ProjectCalendarModel.coffee
              </a>
            
              
              <a class="source" href="ProjectDiscussionCommentModel.html">
                ProjectDiscussionCommentModel.coffee
              </a>
            
              
              <a class="source" href="ProjectDiscussionModel.html">
                ProjectDiscussionModel.coffee
              </a>
            
              
              <a class="source" href="ProjectMemberModel.html">
                ProjectMemberModel.coffee
              </a>
            
              
              <a class="source" href="ProjectModel.html">
                ProjectModel.coffee
              </a>
            
              
              <a class="source" href="ResourceModel.html">
                ResourceModel.coffee
              </a>
            
              
              <a class="source" href="UpdateModel.html">
                UpdateModel.coffee
              </a>
            
              
              <a class="source" href="UserModel.html">
                UserModel.coffee
              </a>
            
              
              <a class="source" href="CBUAdminView.html">
                CBUAdminView.coffee
              </a>
            
              
              <a class="source" href="CBUCityView.html">
                CBUCityView.coffee
              </a>
            
              
              <a class="source" href="CBUDashboardView.html">
                CBUDashboardView.coffee
              </a>
            
              
              <a class="source" href="CBUDiscoverView.html">
                CBUDiscoverView.coffee
              </a>
            
              
              <a class="source" href="CBUFundraisingView.html">
                CBUFundraisingView.coffee
              </a>
            
              
              <a class="source" href="CBULoginView.html">
                CBULoginView.coffee
              </a>
            
              
              <a class="source" href="CBUMainView.html">
                CBUMainView.coffee
              </a>
            
              
              <a class="source" href="CBUProjectOwnerView.html">
                CBUProjectOwnerView.coffee
              </a>
            
              
              <a class="source" href="CBUProjectView.html">
                CBUProjectView.coffee
              </a>
            
              
              <a class="source" href="CBUSignupView.html">
                CBUSignupView.coffee
              </a>
            
              
              <a class="source" href="CBUStreamView.html">
                CBUStreamView.coffee
              </a>
            
              
              <a class="source" href="CBUStripeEdit.html">
                CBUStripeEdit.coffee
              </a>
            
              
              <a class="source" href="CBUUserView.html">
                CBUUserView.coffee
              </a>
            
              
              <a class="source" href="BannerSearchView.html">
                BannerSearchView.coffee
              </a>
            
              
              <a class="source" href="BannerImageView.html">
                BannerImageView.coffee
              </a>
            
              
              <a class="source" href="ProjectAddUpdateView.html">
                ProjectAddUpdateView.coffee
              </a>
            
              
              <a class="source" href="ProjectCalenderView.html">
                ProjectCalenderView.coffee
              </a>
            
              
              <a class="source" href="ProjectDiscussionCommentView.html">
                ProjectDiscussionCommentView.coffee
              </a>
            
              
              <a class="source" href="ProjectDiscussionListItemView.html">
                ProjectDiscussionListItemView.coffee
              </a>
            
              
              <a class="source" href="ProjectDiscussionPreviewView.html">
                ProjectDiscussionPreviewView.coffee
              </a>
            
              
              <a class="source" href="ProjectDiscussionThreadItemView.html">
                ProjectDiscussionThreadItemView.coffee
              </a>
            
              
              <a class="source" href="ProjectDiscussionView.html">
                ProjectDiscussionView.coffee
              </a>
            
              
              <a class="source" href="ProjectDiscussionsView.html">
                ProjectDiscussionsView.coffee
              </a>
            
              
              <a class="source" href="ProjectDonationModalView.html">
                ProjectDonationModalView.coffee
              </a>
            
              
              <a class="source" href="ProjectEmbedCalendarModalView.html">
                ProjectEmbedCalendarModalView.coffee
              </a>
            
              
              <a class="source" href="ProjectFundraisingView.html">
                ProjectFundraisingView.coffee
              </a>
            
              
              <a class="source" href="ProjectInfoAppearanceView.html">
                ProjectInfoAppearanceView.coffee
              </a>
            
              
              <a class="source" href="ProjectMemberListItemView.html">
                ProjectMemberListItemView.coffee
              </a>
            
              
              <a class="source" href="ProjectMembersView.html">
                ProjectMembersView.coffee
              </a>
            
              
              <a class="source" href="ProjectNewDiscussionView.html">
                ProjectNewDiscussionView.coffee
              </a>
            
              
              <a class="source" href="ProjectSubView.html">
                ProjectSubView.coffee
              </a>
            
              
              <a class="source" href="ProjectUpdateSuccessModalView.html">
                ProjectUpdateSuccessModalView.coffee
              </a>
            
              
              <a class="source" href="AbstractModalView.html">
                AbstractModalView.coffee
              </a>
            
              
              <a class="source" href="AbstractView.html">
                AbstractView.coffee
              </a>
            
              
              <a class="source" href="CreateModalView.html">
                CreateModalView.coffee
              </a>
            
              
              <a class="source" href="CreateView.html">
                CreateView.coffee
              </a>
            
              
              <a class="source" href="ForgotPasswordModalView.html">
                ForgotPasswordModalView.coffee
              </a>
            
              
              <a class="source" href="PostReplyView.html">
                PostReplyView.coffee
              </a>
            
              
              <a class="source" href="ResourceProjectPreviewView.html">
                ResourceProjectPreviewView.coffee
              </a>
            
              
              <a class="source" href="UpdateListItemView.html">
                UpdateListItemView.coffee
              </a>
            
              
              <a class="source" href="UpdatesView.html">
                UpdatesView.coffee
              </a>
            
              
              <a class="source" href="WysiwygFormView.html">
                WysiwygFormView.coffee
              </a>
            
              
              <a class="source" href="ProfileEditView.html">
                ProfileEditView.coffee
              </a>
            
              
              <a class="source" href="UserStreamItemView.html">
                UserStreamItemView.coffee
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>CBUDashboardView.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>define ["underscore", 
        "backbone", 
        "bootstrap-fileupload", 
        "button"
        "jquery", 
        "template", 
        "abstract-view", 
        "collection/ProjectListCollection", 
        "model/UserModel",
        "resource-project-view",
        "views/partials-user/ProfileEditView"], 
    (_, 
     Backbone, 
     fileupload, 
     button, 
     $, 
     temp, 
     AbstractView, 
     ProjectListCollection, 
     UserModel, 
     ResourceProjectPreviewView, 
     ProfileEditView) -&gt;

        CBUDashboardView = AbstractView.extend

            currentView:""
            className: "body-container"
            location:{name: "", lat: 0, lon: 0} 

            initialize: (options_) -&gt;
                AbstractView::initialize.call @, options_
                
                @userModel = new UserModel(id:@model.id)
                @userModel.fetch 
                    success: =&gt;@render() 

            events: -&gt;
                _.extend {}, AbstractView.prototype.events, {"click a[href^='#']":"changeHash"}

            render: -&gt;
                @$el.template @templateDir+"dashboard.html", 
                    {data:@userModel.attributes}, =&gt; @onTemplateLoad()
                $(@parent).append @$el

            onTemplateLoad: -&gt;
                @loadProjects()

                @$manageView  = $('#manage-projects')
                @$followView  = $('#follow-projects')
                @$profileView = $('#edit-profile')
                
                @$manageBTN   = $("a[href='#manage']").parent()
                @$followBTN   = $("a[href='#follow']").parent()
                @$profileBTN  = $("a[href='#profile']").parent()

                $(window).bind "hashchange", (e) =&gt; @toggleSubView()
                @toggleSubView()

                profileEditView = new ProfileEditView({model:@userModel, parent:@$profileView})

                AbstractView::onTemplateLoad.call @

            toggleSubView: -&gt; 
                onPageElementsLoad()
                
                @currentView = window.location.hash.substring(1)

                for v in [@$manageView,@$profileView,@$followView]
                    v.hide()

                for btn in [@$followBTN,@$profileBTN,@$manageBTN]
                    btn.removeClass "active"

                switch @currentView 
                    when "follow"
                        @$followView.show()
                        @$followBTN.addClass "active"
                    when "profile"
                        @$profileView.show()
                        @$profileBTN.addClass "active"
                    else 
                        @$manageView.show()
                        @$manageBTN.addClass "active"

            loadProjects:-&gt; 
                @joinedProjects = new ProjectListCollection()
                @joinedProjects.url = "/api/project/user/#{@model.id}/joined-projects"
                @joinedProjects.on "reset", @addJoined, @
                @joinedProjects.on "remove change", @updateCount, @ 
                @joinedProjects.fetch reset: true

                @ownedProjects = new ProjectListCollection()
                @ownedProjects.url = "/api/project/user/#{@model.id}/owned-projects"
                @ownedProjects.on "reset", @addOwned, @
                @ownedProjects.on "remove change", @updateCount, @ 
                @ownedProjects.fetch reset: true

            updateCount:-&gt;
                $('a[href=#follow]').html "Follow (#{@joinedProjects.length})"
                $('a[href=#manage]').html "Manage (#{@ownedProjects.length})"

            addJoined:-&gt;
                if @joinedProjects.length &gt; 0 then @$followView.find('.updates-container').remove()

                @updateCount() 
                @updateProjects(@joinedProjects.models, @$followView.find(".projects"), false, true)
                @setPages @joinedProjects.length, @$followView

                @delegateEvents()

            addOwned:-&gt;
                if @ownedProjects.length &gt; 0 then @$manageView.find('.updates-container').remove()

                @updateCount() 
                @updateProjects(@ownedProjects.models, @$manageView.find(".projects"), true, false)
                @setPages @ownedProjects.length, @$manageView

                @delegateEvents()

            updatePage:-&gt;

                if @currentView is "follow"
                    $ul = @$followView.find(".projects")
                    $ul.html("")
                    @updateProjects(@joinedProjects.models, $ul, false, true)
                else
                    $ul = @$manageView.find(".projects")
                    $ul.html("")
                    @updateProjects(@ownedProjects.models, $ul, true, false)

                $("html, body").animate({ scrollTop: 0 }, "slow")

            updateProjects:(results_, parent_, isOwned_=false, isFollowed_=false)-&gt; 
                s = @index*@perPage
                e = (@index+1)*@perPage-1
                for i in [s..e]
                    if i &lt; results_.length
                        projectModel = results_[i]
                        @addOne(projectModel, parent_, isOwned_, isFollowed_)

            addOne: (projectModel_, parent_, isOwned_=false, isFollowed_=false) -&gt;
                view = new ResourceProjectPreviewView
                    model: projectModel_
                    isOwned: isOwned_
                    isFollowed: isFollowed_
                    isProject: true
                    isResource: false
                    parent:parent_
                view.fetch()</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
